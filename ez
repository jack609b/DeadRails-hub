-- Tải thư viện GUI OrionLib
local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source"))()

-- Tạo cửa sổ GUI chính
local Window = OrionLib:MakeWindow({
    Name = "Dead Rails-hub | By: Minh",
    HidePremium = false,
    SaveConfig = true,
    ConfigFolder = "DeadRailsHub"
})

-- Tạo các tab
local MainTab = Window:MakeTab({Name = "Chức năng chính", Icon = "rbxassetid://4483345998", PremiumOnly = false})
local MovementTab = Window:MakeTab({Name = "Di chuyển", Icon = "rbxassetid://4483345998", PremiumOnly = false})
local VisualTab = Window:MakeTab({Name = "Hình ảnh", Icon = "rbxassetid://4483345998", PremiumOnly = false})
local ProtectionTab = Window:MakeTab({Name = "Bảo vệ", Icon = "rbxassetid://4483345998", PremiumOnly = false})

-- Biến trạng thái
local gunAuraEnabled = false
local infiniteJumpEnabled = false
local noclipEnabled = false
local bondCollected = 0

-- Gun Aura
MainTab:AddToggle({
    Name = "Gun Aura",
    Default = false,
    Callback = function(Value)
        gunAuraEnabled = Value
        if Value then
            spawn(function()
                while gunAuraEnabled and task.wait(0.3) do
                    for _, v in pairs(game:GetService("Players"):GetPlayers()) do
                        if v ~= game.Players.LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                            local tool = game.Players.LocalPlayer.Character:FindFirstChildOfClass("Tool")
                            if tool and tool:FindFirstChild("Handle") then
                                local dist = (v.Character.HumanoidRootPart.Position - game.Players.LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
                                if dist < 20 then
                                    tool:Activate()
                                    tool.Handle.CFrame = v.Character.HumanoidRootPart.CFrame
                                end
                            end
                        end
                    end
                end
            end)
        end
    end
})

-- Thu thập Bond & Đạn
MainTab:AddButton({
    Name = "Thu thập Bond & Đạn",
    Callback = function()
        local collected = 0
        for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("Tool") and (obj.Name:lower():find("bond") or obj.Name:lower():find("ammo")) and obj:FindFirstChild("Handle") then
                firetouchinterest(game.Players.LocalPlayer.Character.HumanoidRootPart, obj.Handle, 0)
                firetouchinterest(game.Players.LocalPlayer.Character.HumanoidRootPart, obj.Handle, 1)
                collected += 1
            end
        end
        bondCollected += collected
        OrionLib:MakeNotification({
            Name = "Đã thu thập",
            Content = "Thu thêm " .. collected .. " bond/đạn (Tổng: " .. bondCollected .. ")",
            Time = 5
        })
    end
})

-- ESP
MainTab:AddButton({
    Name = "ESP (Hiển thị người chơi)",
    Callback = function()
        for _, v in pairs(game:GetService("Players"):GetPlayers()) do
            if v ~= game.Players.LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                if not v.Character.HumanoidRootPart:FindFirstChild("ESPBox") then
                    local box = Instance.new("BoxHandleAdornment")
                    box.Name = "ESPBox"
                    box.Size = Vector3.new(4, 6, 4)
                    box.Adornee = v.Character.HumanoidRootPart
                    box.AlwaysOnTop = true
                    box.ZIndex = 10
                    box.Color3 = Color3.new(1, 0, 0)
                    box.Transparency = 0.4
                    box.Parent = v.Character.HumanoidRootPart
                end
            end
        end
    end
})

-- Mở khóa Camera
MainTab:AddButton({
    Name = "Mở khóa Camera",
    Callback = function()
        game.Players.LocalPlayer.CameraMaxZoomDistance = 999
        game.Players.LocalPlayer.CameraMinZoomDistance = 0.5
    end
})

-- Tiền vô hạn
MainTab:AddButton({
    Name = "Tiền vô hạn",
    Callback = function()
        local p = game.Players.LocalPlayer
        local success, err = pcall(function()
            if p:FindFirstChild("leaderstats") and p.leaderstats:FindFirstChild("Cash") then
                p.leaderstats.Cash.Value = 999999999
            elseif p:FindFirstChild("Data") and p.Data:FindFirstChild("Money") then
                p.Data.Money.Value = 999999999
            else
                OrionLib:MakeNotification({
                    Name = "Không tìm thấy tiền",
                    Content = "Không có thuộc tính tiền trong leaderstats hoặc Data.",
                    Time = 4
                })
                return
            end
        end)
        if success then
            OrionLib:MakeNotification({
                Name = "Hoàn tất",
                Content = "Bạn đã nhận 999,999,999 tiền!",
                Time = 4
            })
        end
    end
})

-- Full Bright
VisualTab:AddButton({
    Name = "Tăng độ sáng toàn cảnh",
    Callback = function()
        local Lighting = game:GetService("Lighting")
        Lighting.Brightness = 2
        Lighting.ClockTime = 14
        Lighting.FogEnd = 100000
        Lighting.GlobalShadows = false
    end
})

-- Infinite Jump
MovementTab:AddToggle({
    Name = "Nhảy vô hạn",
    Default = false,
    Callback = function(Value)
        infiniteJumpEnabled = Value
    end
})

game:GetService("UserInputService").JumpRequest:Connect(function()
    if infiniteJumpEnabled and game.Players.LocalPlayer.Character then
        local hum = game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then hum:ChangeState("Jumping") end
    end
end)

-- Tăng tốc độ
MovementTab:AddSlider({
    Name = "Tốc độ di chuyển",
    Min = 16,
    Max = 100,
    Default = 16,
    Color = Color3.fromRGB(255,255,255),
    Increment = 1,
    ValueName = "Speed",
    Callback = function(Value)
        local hum = game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then hum.WalkSpeed = Value end
    end
})

-- NoClip
MovementTab:AddToggle({
    Name = "Đi xuyên tường (NoClip)",
    Default = false,
    Callback = function(Value)
        noclipEnabled = Value
    end
})

game:GetService("RunService").Stepped:Connect(function()
    if noclipEnabled and game.Players.LocalPlayer.Character then
        for _, part in pairs(game.Players.LocalPlayer.Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end
end)

-- Dịch chuyển tới cuối màn (thay đổi tọa độ phù hợp nếu cần)
MainTab:AddButton({
    Name = "Dịch chuyển đến cuối màn",
    Callback = function()
        local endPart = workspace:FindFirstChild("EndPart")
        if endPart then
            game.Players.LocalPlayer.Character:MoveTo(endPart.Position)
        else
            OrionLib:MakeNotification({
                Name = "Không tìm thấy điểm cuối",
                Content = "Không có object tên 'EndPart' trong workspace!",
                Time = 4
            })
        end
    end
})

-- Anti-Kick
ProtectionTab:AddButton({
    Name = "Chống bị kick",
    Callback = function()
        local mt = getrawmetatable(game)
        if not mt then return end
        setreadonly(mt, false)
        local old = mt.__namecall
        mt.__namecall = newcclosure(function(self, ...)
            local args = {...}
            if getnamecallmethod() == "Kick" then return nil end
            return old(self, unpack(args))
        end)
        setreadonly(mt, true)
        OrionLib:MakeNotification({
            Name = "Đã bật",
            Content = "Chống bị kick đã được kích hoạt.",
            Time = 4
        })
    end
})
